{% extends 'base.html' %}
{% load static %}

{% block title %}{{ producto.artista }} - {{ producto.album }}{% endblock %}

{% block content %}

<a href="{% url 'catalogo' %}" style="color: var(--color-navbar); font-weight: bold; text-decoration: none; margin-bottom: 15px; display: inline-block;">
    ‚Üê Volver al Cat√°logo
</a>

<div class="detalle-grid">
    
    <div class="detalle-imagen-col">
        {% if producto.imagen_portada %}
            <img src="{{ producto.imagen_portada.url }}" alt="Portada de {{ producto.album }}" 
                class="detalle-imagen" id="detalle-main-image">
        {% else %}
            <img src="{% static 'tienda_artaud/sin_imagen.png' %}" alt="Sin imagen de portada" 
                class="detalle-imagen" id="detalle-main-image" style="object-fit: contain; background-color: #f0f0f0;">
        {% endif %}
        <span class="zoom-button" id="zoom-button">Clic para hacer zoom</span>
    </div>

    <div class="detalle-info-col">
        
        <h1>{{ producto.artista }}</h1>
        <h1>{{ producto.album }}</h1>
        <p class="vendedor-info">Vendido por: <strong>{{ producto.vendedor.username }}</strong></p>

        <span class="precio-detalle">${{ producto.precio|floatformat:2 }}</span>

        {% if producto.stock > 0 %}
            {% if producto.vendedor != request.user %}
                <div style="display: flex; align-items: stretch; gap: 15px; margin-bottom: 20px;">                    
                    <form method="POST" action="{% url 'agregar_a_carrito' producto_id=producto.pk %}" style="margin: 0; flex: 1;">
                        {% csrf_token %}
                        <button type="submit" class="btn-add-to-cart" style="width: 100%; height: 100%;">
                            A√±adir al Carrito üõí
                        </button>
                    </form>
                    
                    <form method="POST" action="{% url 'toggle_favorito' producto_id=producto.pk %}" style="margin: 0; flex: 1;">
                        {% csrf_token %}
                        <button type="submit" class="btn-favorito-detalle 
                                {% if request.user in producto.favoritos.all %}favorited{% endif %}" 
                                aria-label="Alternar favoritos" style="width: 100%; height: 100%;">
                            
                            {% if request.user in producto.favoritos.all %}
                                <span style="margin-right: 5px;">‚ù§Ô∏è</span> Quitar de favoritos
                            {% else %}
                                <span style="margin-right: 5px;">‚ô°</span> Agregar a favoritos
                            {% endif %}
                            
                        </button>
                    </form>
                </div>

            {% else %}
                <div style="margin-bottom: 20px;">
                    <p style="color: var(--color-navbar); font-weight: bold; font-size: 1.1em;">
                        Est√°s viendo un art√≠culo propio.
                    </p>
                    <a href="{% url 'editar_producto' pk=producto.pk %}" style="color: var(--color-acento); text-decoration: underline;">Editar tu publicaci√≥n</a>
                </div>
            {% endif %}

        {% else %}
            <div style="margin-bottom: 20px;">
                <p class="stock-agotado" style="font-size: 1.3em;">¬°AGOTADO!</p>
            </div>
        {% endif %}
        
        <table class="metadata-tabla">
            <tr>
                <td>Stock Disponible</td>
                <td>
                    {% if producto.stock <= 0 %}
                        <strong class="stock-agotado">AGOTADO</strong>
                    {% elif producto.stock <= 5 %}
                        <strong class="stock-alerta">{{ producto.stock }}</strong> unidades (¬°Bajo!)
                    {% else %}
                        <strong class="stock-alto">{{ producto.stock }}</strong> unidades
                    {% endif %}
                </td>
            </tr>
            <tr><td>Formato</td><td>{{ producto.get_formato_display }}</td></tr>
            <tr><td>Condici√≥n</td><td>{{ producto.get_condicion_display }}</td></tr>
            <tr><td>Estado F√≠sico</td><td>{{ producto.get_estado_display }}</td></tr>
            <tr><td>Sello</td><td>{{ producto.sello|default:"N/A" }}</td></tr>
            <tr><td>Pa√≠s</td><td>{{ producto.pais|default:"N/A" }}</td></tr>
            <tr><td>A√±o de Lanzamiento</td><td>{{ producto.anio_lanzamiento }}</td></tr>
            <tr><td>C√≥digo de Barras</td><td>{{ producto.codigo_barras|default:"No registrado" }}</td></tr>
        </table>
    </div>
</div>

<div class="descripcion-larga">
    <h2>Descripci√≥n del Vendedor</h2>
    <p>{{ producto.descripcion }}</p>
</div>

<div id="image-zoom-modal" class="image-zoom-modal">
    <div class="modal-wrapper">
        <span class="close-button">&times;</span>
        <img class="modal-content" id="modal-zoomed-image" alt="Imagen con zoom">
    </div>
</div>

{% endblock content %}
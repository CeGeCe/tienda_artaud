{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tienda Artaud{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'tienda_artaud/styles.css' %}">
</head>

<body>

<header>
    <nav class="navbar">
        <div class="nav-left">
            <a href="{% url 'home' %}" class="navbar-brand-link">
                <img src="{% static 'tienda_artaud/artaud_logo.png' %}" alt="Logo" class="brand-icon"> 
                <span class="brand-text">Tienda Artaud</span>
            </a>

            <div class="nav-links-simple">
                <a href="{% url 'about' %}">Nosotros</a>
                <a href="#">Blog</a>
                <a href="{% url 'catalogo' %}">Cat√°logo</a>
            </div>

            <button id="dark-mode-toggle" onclick="toggleDarkMode()" 
                    style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2em; margin-right: 15px;" 
                    aria-label="Alternar modo oscuro">
                ‚òÄÔ∏è
            </button>

            <button onclick="abrirRadio()" class="icon-btn" title="Abrir Radio Artaud üìª" style="margin-right: 10px;">
            ‚ñ∂Ô∏è
            </button>

            <script>
                function abrirRadio() {
                    // Abre una ventana de 350x600 px
                    const url = "{% url 'radio_artaud' %}";
                    const nombre = "RadioArtaud";
                    const opciones = "width=380,height=600,resizable=no,scrollbars=no,status=no,toolbar=no";
                    
                    // Si ya existe la ventana, la enfoca. Si no, la crea.
                    window.open(url, nombre, opciones);
                }
            </script>
        </div>

        <div class="nav-search-wrapper">
            <form action="{% url 'catalogo' %}" method="get" class="nav-search-form">
                
                <button type="button" id="voice-search-button" class="nav-voice-btn" aria-label="Buscar por voz">
                    üé§
                </button>

                <input type="text" name="q" placeholder="Buscar..." 
                    value="{{ request.GET.q|default:'' }}" 
                    class="nav-search-field search-input">
                
                {% if request.GET.q %}
                    <a href="{% url 'catalogo' %}" class="nav-search-clear" aria-label="Borrar">‚úï</a>
                {% endif %}

                <button type="submit" class="nav-search-btn" aria-label="Buscar">
                    üîç
                </button>
            </form>
        </div>

        <div class="nav-right">
            {% if user.is_authenticated %}

                <div class="dropdown">
                    <a href="#" class="nav-link-icon user-pill">
                        üë§ {{ user.username|truncatechars:10 }}
                    </a>
                    <div class="dropdown-content">
                        <a href="#">Dashboard üìä</a> {% if user.is_staff %}
                            <hr style="margin: 0; border-top: 1px solid #ddd;">
                            <a href="{% url 'admin:index' %}">Acceso Admin üëÆ‚Äç‚ôÇÔ∏è</a>
                        {% endif %}
                        
                        <hr style="margin: 0; border-top: 1px solid #ddd;">
                        <form method="post" action="{% url 'account_logout' %}" style="padding: 0;">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-logout-btn">Cerrar Sesi√≥n</button>
                        </form>
                    </div>
                </div>

                <div class="dropdown">
                    <a href="#" class="nav-link-icon">Mis Ventas ‚ñæ</a>
                    <div class="dropdown-content">
                        <a href="{% url 'panel_ventas' %}">Panel de Ventas üí∏</a>
                        <a href="{% url 'mis_productos' %}">Mis Productos</a>
                        <a href="{% url 'publicar_producto' %}">Publicar Nuevo ‚ûï</a>
                    </div>
                </div>

                <a href="{% url 'ver_pedidos' %}" class="nav-link-icon">Mis Compras</a>
                
                <div class="dropdown rich-dropdown">
                    <a href="{% url 'ver_favoritos' %}" class="nav-link-icon">Favoritos</a>
                    <div class="dropdown-content preview-list">
                        <div class="preview-header">√öltimos Favoritos</div>
                        {% if navbar_favs %}
                            {% for prod in navbar_favs %}
                                <a href="{% url 'detalle_producto' pk=prod.pk %}" class="preview-item">
                                    {% if prod.imagen_portada %}
                                        <img src="{{ prod.imagen_portada.url }}" class="preview-img">
                                    {% endif %}
                                    <div class="preview-info">
                                        <span class="preview-title">{{ prod.album|truncatechars:15 }}</span>
                                        <span class="preview-price">${{ prod.precio|floatformat:0 }}</span>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div style="padding: 10px; color: #777; font-size: 0.9em;">Sin favoritos a√∫n.</div>
                        {% endif %}
                        <a href="{% url 'ver_favoritos' %}" class="preview-footer-link">Ver Todos los Favoritos ‚Üí</a>
                    </div>
                </div>

                <div class="dropdown rich-dropdown">
                    <a href="{% url 'ver_carrito' %}" class="nav-link-icon">
                        üõí <span class="badge">{{ navbar_cart_count }}</span>
                    </a>
                    <div class="dropdown-content preview-list">
                        <div class="preview-header">Tu Carrito</div>
                        {% if navbar_cart_items %}
                            {% for item in navbar_cart_items %}
                                <a href="{% url 'detalle_producto' pk=item.producto.pk %}" class="preview-item">
                                    {% if item.producto.imagen_portada %}
                                        <img src="{{ item.producto.imagen_portada.url }}" class="preview-img">
                                    {% endif %}
                                    <div class="preview-info">
                                        <span class="preview-title">{{ item.producto.album|truncatechars:15 }}</span>
                                        <span class="preview-qty">x{{ item.cantidad }}</span>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div style="padding: 10px; color: #777; font-size: 0.9em;">Carrito vac√≠o.</div>
                        {% endif %}
                        <a href="{% url 'ver_carrito' %}" class="preview-footer-link">Ir al Carrito ‚Üí</a>
                    </div>
                </div>

            {% else %}
                <a href="{% url 'account_login' %}" style="color: white; text-decoration: none; font-weight: bold;">Ingresar / Registrarse</a>
            {% endif %}
        </div>
    </nav>
</header>

    <main class="content-container">

        {% if messages %}
            <div class="message-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                        <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock content %}
    </main>

<script src="{% static 'tienda_artaud/scripts/theme.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/busq_voz.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/catalogo_sort.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/zoom.js' %}"></script>

<footer class="main-footer">
    <div class="footer-container">
        <div class="footer-col">
            <h4>Navegaci√≥n</h4>
            <a href="{% url 'home' %}">Inicio</a>
            <a href="{% url 'catalogo' %}">Cat√°logo</a>
            <a href="{% url 'about' %}">Sobre Nosotros</a>
            Blog
        </div>
        <div class="footer-col">
            <h4>Mi Cuenta</h4>
            <a href="{% url 'account_login' %}">Ingresar</a>
            <a href="{% url 'ver_pedidos' %}">Mis Compras</a>
            <a href="{% url 'mis_productos' %}">Mis Productos</a>
        </div>
        <div class="footer-col">
            <h4>Legales</h4>
            <a href="#">T√©rminos y Condiciones</a>
            <a href="#">Pol√≠tica de Privacidad</a>
            <a href="#">Ayuda y Soporte</a>
        </div>
        <div class="footer-col">
            <h4>Contacto</h4>
            <p>Email: info@tienda-artaud.com</p>
            <p>Tel: +54 11 5555-ARTAUD</p>
        </div>
        <div class="footer-col">
            <h4>Redes Sociales</h4>
            <div>
                <a href="https://facebook.com" aria-label="Facebook">Facebook</a>
                <a href="https://instagram.com" aria-label="Instagram">Instagram</a>
                <a href="https://twitter.com" aria-label="Twitter">X (Twitter)</a>
                <a href="https://tiktok.com" aria-label="TikTok">TikTok</a>
            </div>
        </div>
    </div>
    <div class="footer-copy">
        &copy; 2025 Tienda Artaud. Todos los derechos reservados.
    </div>
</footer>

</body>
</html>
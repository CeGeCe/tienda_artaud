{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tienda Artaud{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'tienda_artaud/styles.css' %}">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>

<body>

<header>
    <nav class="navbar">
        <div class="nav-left">
            <a href="{% url 'home' %}" class="navbar-brand-link">
                <img src="{% static 'tienda_artaud/icons/artaud_logo.png' %}" alt="Logo" class="brand-icon"> 
                <span class="brand-text">Tienda Artaud</span>
            </a>

            <div class="nav-links-simple">
                <a href="{% url 'about' %}">Nosotros</a>
                <a href="{% url 'blog_lista' %}">Blog</a>
                <a href="{% url 'catalogo' %}">Cat√°logo</a>
            </div>

            <button id="dark-mode-toggle" onclick="toggleDarkMode()" 
                    style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2em;" 
                    title="Alternar modo oscuro">
                ‚òÄÔ∏è
            </button>

            <button onclick="abrirRadio()" class="icon-btn" title="Abrir Radio Artaud üìª" style="margin-right: 10px;">
                üìª
            </button>

            <script>
                function abrirRadio() {
                    const url = "{% url 'radio_artaud' %}";
                    const nombre = "RadioArtaud";
                    const opciones = "width=420,height=700,resizable=yes,scrollbars=no,status=no,toolbar=no";
                    
                    // Si ya existe la ventana, la enfoca. Si no, la crea.
                    window.open(url, nombre, opciones);
                }
            </script>
        </div>

        <div class="nav-search-wrapper">
            <form action="{% url 'catalogo' %}" method="get" class="nav-search-form">
                
                <button type="button" id="voice-search-button" class="nav-voice-btn" title="B√∫squeda por voz">
                    üé§
                </button>

                <button type="button" id="barcode-search-btn" class="nav-voice-btn" title="Escanear c√≥digo" style="border-right: 1px solid rgba(255,255,255,0.3);">
                    |||
                </button>
                <input type="file" id="barcode-search-input" accept="image/*" style="display: none;">

                <input type="text" name="q" placeholder="Buscar por Artista, √Ålbum, Sello, Pa√≠s, etc..." 
                    value="{{ request.GET.q|default:'' }}" 
                    class="nav-search-field search-input" id="main-search-input">
                
                {% if request.GET.q %}
                    <a href="{% url 'catalogo' %}" class="nav-search-clear" aria-label="Borrar b√∫squeda">‚úï</a>
                {% endif %}

                <button type="submit" class="nav-search-btn" aria-label="Buscar">
                    üîç
                </button>
            </form>
        </div>

        <div class="nav-right">
            {% if user.is_authenticated %}

                <div class="dropdown">
                    <a href="#" class="nav-link-icon user-pill">
                        üë§ {{ user.username|truncatechars:10 }}
                    </a>
                    <div class="dropdown-content">
                        <a href="{% url 'ver_vendedor' username=user.username %}">Mi Perfil</a>
                        <a href="{% url 'mi_perfil' %}">Mis Datos</a>
                        {% if user.is_staff %}
                            <hr style="margin: 0; border-top: 1px solid #ddd;">

                            <a href="{% url 'admin_dashboard' %}">üåê Ventas Globales</a>
                            <a href="{% url 'admin:index' %}">üëÆ‚Äç‚ôÇÔ∏è Acceso Admin</a>
                        {% endif %}
                        
                        <hr style="margin: 0; border-top: 1px solid #eee;">

                        <form method="post" action="{% url 'account_logout' %}" style="padding: 0;">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-logout-btn">Cerrar Sesi√≥n</button>
                        </form>
                    </div>
                </div>

                <div class="dropdown">
                    <a href="#" class="nav-link-icon">Mis Ventas ‚ñæ</a>
                    <div class="dropdown-content">
                        <a href="{% url 'panel_ventas' %}">Panel de Ventas üí∏</a>
                        <a href="{% url 'mis_productos' %}">Mis Productos</a>
                        <a href="{% url 'publicar_producto' %}">Publicar Nuevo ‚ûï</a>
                    </div>
                </div>

                <a href="{% url 'ver_pedidos' %}" class="nav-link-icon">Mis Compras</a>
                
                <a href="{% url 'ver_favoritos' %}" class="nav-link-icon">
                    ‚ù§ Favoritos <span class="fav-count">{{ navbar_favs_count }}</span>
                </a>

                <a href="{% url 'ver_carrito' %}" class="nav-link-icon">
                    üõí Carrito <span class="badge">{{ navbar_cart_count }}</span>
                </a>

            {% else %}
                <a href="{% url 'account_login' %}" style="color: white; text-decoration: none; font-weight: bold;">Ingresar / Registrarse</a>
            {% endif %}
        </div>
    </nav>
</header>

    <main class="content-container">

        {% if messages %}
            <div class="message-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                        <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock content %}
    </main>

<script src="{% static 'tienda_artaud/scripts/theme.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/busq_voz.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/catalogo_sort.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/zoom.js' %}"></script>
<script src="{% static 'tienda_artaud/scripts/barcode.js' %}"></script>

<footer class="main-footer">
    <div class="footer-container">
        <div class="footer-col">
            <h4>Navegaci√≥n</h4>
            <a href="{% url 'home' %}">Inicio</a>
            <a href="{% url 'about' %}">Sobre Nosotros</a>
            <a href="{% url 'blog_lista' %}">Blog</a>
            <a href="{% url 'scraper_libros' %}">Scraper_TEST</a>
            <a href="{% url 'scraper_jeds' %}">Scraper Jeds</a>
        </div>
        <div class="footer-col">
            <h4>Mi Cuenta</h4>
            <a href="{% url 'account_login' %}">Ingresar</a>
            <a href="{% url 'ver_pedidos' %}">Mis Compras</a>
            <a href="{% url 'mis_productos' %}">Mis Productos</a>
        </div>
        <div class="footer-col">
            <h4>Legales</h4>
            <a href="#">T√©rminos y Condiciones</a>
            <a href="#">Pol√≠tica de Privacidad</a>
            <a href="#">Ayuda y Soporte</a>
        </div>
        <div class="footer-col">
            <h4>Contacto</h4>
            <p>Email: info@tienda-artaud.com</p>
            <p>Tel: +54 11 5555-ARTAUD</p>
        </div>
        <div class="footer-col">
            <h4>Redes Sociales</h4>
            <div>
                <a href="https://rateyourmusic.com/" aria-label="Rate Your Music">Rate Your Music</a>
                <a href="https://www.last.fm/" aria-label="Last.fm">Last.fm</a>
                <a href="https://facebook.com" aria-label="Facebook">Facebook</a>
                <a href="https://instagram.com" aria-label="Instagram">Instagram</a>
                <a href="https://twitter.com" aria-label="Twitter">X (Twitter)</a>
            </div>
        </div>
    </div>
    <div class="footer-copy">
        &copy; 2025 Tienda Artaud. Todos los derechos reservados.
    </div>
</footer>


    <div id="scanner-modal" class="scanner-modal">
        <div class="scanner-content">
            <span class="close-scanner">&times;</span>
            <h3 style="text-align: center; color: #333; margin-bottom: 10px;">Escanear C√≥digo</h3>

            <div id="reader" style="width: 100%;"></div>

            <p style="text-align: center; font-size: 0.9em; color: #777; margin-top: 10px;">
                Apunta la c√°mara al c√≥digo de barras
            </p>
        </div>
    </div>

</body>
</html>
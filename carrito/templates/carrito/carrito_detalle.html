{% extends 'base.html' %}
{% load static %}

{% block title %}Mi Carrito{% endblock %}

{% block content %}

<div class="carrito-container">
    <h1 style="color: var(--color-navbar);">üõí Mi Carrito</h1>

    {% if carrito.items.count %}

    <div class="item-list">
        {% for item in carrito.items.all %}
            <div class="item-card">

                {% if item.producto.imagen_portada %}
                <img src="{{ item.producto.imagen_portada.url }}" alt="{{ item.producto.album }}" class="item-img">
                {% else %}
                <img src="{% static 'tienda_artaud/sin_imagen.png' %}" alt="Sin imagen" class="item-img"
                    style="object-fit: contain; background-color: #f0f0f0;">
                {% endif %}

                <div class="item-details">
                    <p style="margin: 0; font-size: 1.1em;">
                        <strong>{{ item.producto.artista }}</strong> - {{ item.producto.album }}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #777;">
                        Precio unitario: ${{ item.precio_item|floatformat:2 }}
                    </p>

                    <form method="POST" action="{% url 'actualizar_carrito' item_id=item.id %}" class="cart-qty-form"
                        style="margin-top: 10px;">
                        {% csrf_token %}
                        <label for="cantidad_{{ item.id }}">Cantidad:</label>
                        <input type="number" name="cantidad" id="cantidad_{{ item.id }}" value="{{ item.cantidad }}" min="0"
                            max="{{ item.producto.stock }}" onchange="this.form.submit()">
                    </form>
                </div>

                <div style="text-align: right;">
                    <p style="margin: 0; font-size: 0.9em;">Subtotal:</p>
                    <p class="item-price-total" style="margin: 5px 0 10px 0;">
                        ${{ item.get_total|floatformat:2 }}
                    </p>
                    <a href="{% url 'eliminar_de_carrito' item_id=item.id %}"
                        style="color: red; text-decoration: none; font-size: 0.9em;">
                        Eliminar üóëÔ∏è
                    </a>
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="total-box" style="border-color: var(--color-navbar);">
        <h2>Total a Pagar: <span class="item-price-total" style="font-size: 1.5em; color: red;">
                ${{ carrito.get_total|floatformat:2 }}
            </span></h2>
        
        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
        
        <a href="{% url 'opciones_presupuesto' %}" class="btn-details" ...>
            üìÑ Generar Presupuesto
        </a>
            

        <a href="{% url 'checkout' %}" class="btn-add-to-cart" style="width: auto; text-decoration: none;">
            Proceder al Pago
        </a>
    </div>

    {% else %}
    <p style="font-size: 1.2em; margin-top: 30px;">
        Tu carrito est√° vac√≠o.
    </p>
    <a href="{% url 'catalogo' %}" class="btn-checkout" style="background-color: #555;">Ir al Cat√°logo</a>
    {% endif %}

</div>

{% endblock content %}